<!DOCTYPE html><html lang="en"><head><link href="http://fonts.googleapis.com/css?family=PT+Sans:400,700|PT+Serif:400,700" rel="stylesheet" type="text/css"><!-- Meta--><meta charset="utf-8"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Changing unnamed constraints in Play! | Brisk Bee</title><meta name="description" content="Casual rants on mobile development"><meta name="keywords" content="briskbee, haldbæk, peter haldbæk, peter haldbaek, iphone, ios, android, findantenna, dvb-t, java, mobile, development"><meta name="author" content="Peter Haldbæk"><meta name="generator" content="DocPad v6.78.6" /><meta name="viewport" content="width=device-width"><!-- Icons--><link rel="shortcut icon" href="/ico/favicon.ico"><link rel="apple-touch-icon-precomposed" sizes="144x144" href="/ico/apple-touch-icon-144-precomposed.png"><link rel="apple-touch-icon-precomposed" sizes="114x114" href="/ico/apple-touch-icon-114-precomposed.png"><link rel="apple-touch-icon-precomposed" sizes="72x72" href="/ico/apple-touch-icon-72-precomposed.png"><link rel="apple-touch-icon-precomposed" href="/ico/apple-touch-icon-57-precomposed.png"><!--if lt IE 9script(async src="http://html5shim.googlecode.com/svn/trunk/html5.js")
--><!-- Styles--><link  rel="stylesheet" href="/vendor/prettify.css" /><link  rel="stylesheet" href="/vendor/bootstrap/css/bootstrap.min.css" /><link  rel="stylesheet" href="/styles/style.css" /></head><body><!-- Markup--><header><div class="container"><div class="row"><div class="col-md-2 visible-md visible-lg"></div><div class="col-md-8"><div class="background"><div class="top"><a href="/">Brisk Bee</a></div><nav class="topmenu"><ul class="list-inline"><li class="active"><a href="/">BLOG</a></li><li typeof="sioc:Page" about="/pages/about/"><a href="/pages/about/" property="dc:title">About</a></li></ul></nav></div></div><div class="col-md-2 visible-md visible-lg"></div></div></div></header><div class="container"><div class="row"><div class="col-md-2"></div><div class="col-md-8"><section id="content" class="content"><article id="post" class="post"><h1>Changing unnamed constraints in Play!</h1><div class="pubdate">Published August 11th 2012</div><div class="post-content"><p>I have been working on a project based on the <a href="http://www.playframework.org/">Play! framework</a> lately (the old version, <a href="http://www.playframework.org/documentation/1.2.4/home">1.2.4</a>) and I came across a real headscratcher. My problem was I needed to delete a foreign constraint in a table but this constraint had no name (it was not given a name when it was created). Deleting a constraint with standard SQL requires a name so I had to do come up with something else for my evolution script. I was using <a href="http://www.mysql.com/">MySQL</a> in production and <a href="http://www.h2database.com/">H2</a> in test so it was not an option to use some MySQL specific code unless it was compatible with H2.</p>
<p>Let&#39;s make a little example first to illustrate my problem. Consider these two tables:</p>
<pre><code>CREATE TABLE a (
    id INTEGER NOT NULL AUTO_INCREMENT,
    CONSTRAINT pk_a PRIMARY KEY(id)
);
CREATE TABLE b (
    id INTEGER NOT NULL AUTO_INCREMENT,
    a_id INTEGER NOT NULL,
    PRIMARY KEY(id),
    FOREIGN KEY(a_id) REFERENCES a(id)
);
</code></pre><p>Table B has a foreign constraint for the column a_id which points to the id column in the A table. If I wanted to delete the foreign constraint I should execute this statement:</p>
<pre><code>ALTER TABLE b DROP CONSTRAINT &quot;constraint name&quot;
</code></pre><p>But since the foreign constraint was not named initially I cannot use this statement. My next thought was to find a way to list all the foreign constraints of the table and then use the result as input to an alter table statement. I did not find any way to do this with standard SQL but using some MySQL-specific SQL I actually managed to do this. The select query looks like this:</p>
<pre><code>SELECT
    constraint_name,
    CONCAT(table_name, &#39;.&#39;, column_name) AS &#39;foreign key&#39;,
    CONCAT(referenced_table_name, &#39;.&#39;, referenced_column_name) AS &#39;references&#39;
FROM
    information_schema.key_column_usage
WHERE
    referenced_table_name IS NOT NULL;
</code></pre><p>This lists all foreign key constraints in the database. I tried executing it in H2 and to no surprise it did not work.</p>
<p>I decided not to change the existing table but instead create a new table (without constraints) and copy the contents of the old table to the new table. If you need to keep the name of the table as it was you could always rename the table but since the naming of the table was a bit off in my case I actually ended up with a better named table anyway. And I am not sure renaming a table is supported by standard SQL.</p>
<p>So lets first create a new table without the constraints:</p>
<pre><code>CREATE TABLE b_new (
    id INTEGER NOT NULL AUTO_INCREMENT,
    a_id INTEGER NOT NULL,
    CONSTRAINT pk_b PRIMARY KEY(id)
);
</code></pre><p>Then copy the data from the old to the new table:</p>
<pre><code>INSERT INTO b_new SELECT * FROM b ORDER BY id;
</code></pre><p>The last thing to do is to delete the old table (and maybe renaming the new one):</p>
<pre><code>DROP TABLE b;
</code></pre><p>That&#39;s it. Now the table has no foreign constraints.</p>
<p>So if you need a reason for why you always should name your constraints, now you know why.</p>
</div><div id="disqus_thread"></div><script type="text/javascript">/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'briskbee'; // required: replace example with your forum shortname
var disqus_identifier = 'changing_unnamed_constraints_in_play_';
var disqus_title = 'Changing unnamed constraints in Play!';
var disqus_url = 'http://www.briskbee.com/posts/changing_unnamed_constraints_in_play_';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><noscript>Please enable JavaScript to view the<a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a href="http://disqus.com" class="dsq-brlink">comments powered by<span class="logo-disqus">Disqus</span></a></article><section id="related"><h3>Related Posts</h3><nav class="linklist"><li><a href="/posts/jsf_and_onload_for_jdk_1_4/">JSF and OnLoad for JDK 1.4</a> &nbsp;<span class="pubdate">August 7th 2008</span></li><li><a href="/posts/eclipse_and_jboss_as_5_1_with_minimal_configuration/">Eclipse and JBoss AS 5.1 with minimal configuration</a> &nbsp;<span class="pubdate">June 25th 2010</span></li><li><a href="/posts/concrete_-_my_very_own_android_orm/">Concrete - My very own Android ORM</a> &nbsp;<span class="pubdate">October 28th 2010</span></li><li><a href="/posts/conferences/">Conferences</a> &nbsp;<span class="pubdate">January 16th 2010</span></li><li><a href="/posts/cpu_spikes_on_jboss_as_5_1/">CPU spikes on JBoss AS 5.1</a> &nbsp;<span class="pubdate">June 29th 2010</span></li><li><a href="/posts/android_and_xml_parsers/">Android and XML parsers</a> &nbsp;<span class="pubdate">July 1st 2010</span></li><li><a href="/posts/creating_insert_statements_from_table_data/">Creating insert statements from table data</a> &nbsp;<span class="pubdate">October 23rd 2012</span></li><li><a href="/posts/accessing_memory_database_in_play_/">Accessing memory database in Play!</a> &nbsp;<span class="pubdate">September 11th 2012</span></li><li><a href="/posts/hibernate__oracle__hsqldb_and_sequences/">Hibernate, Oracle, HSQLDB and sequences</a> &nbsp;<span class="pubdate">September 22nd 2011</span></li><li><a href="/posts/minimal_jboss_as_5_1_configuration/">Minimal JBoss AS 5.1 configuration</a> &nbsp;<span class="pubdate">June 24th 2010</span></li><li><a href="/posts/mockito__static_imports_and_eclipse/">Mockito, static imports and Eclipse</a> &nbsp;<span class="pubdate">March 26th 2011</span></li><li><a href="/posts/options_for__rest_framework/">Options for  REST framework</a> &nbsp;<span class="pubdate">August 3rd 2010</span></li><li><a href="/posts/setting_character_set_to_utf8_in_mysql/">Setting character set to UTF-8 in MySQL</a> &nbsp;<span class="pubdate">October 25th 2012</span></li><li><a href="/posts/setting_up_a_datasource_in_jndi/">Setting up a datasource in JNDI</a> &nbsp;<span class="pubdate">July 26th 2010</span></li><li><a href="/posts/speeding_up_unit_tests_using_in-memory_database/">Speeding up unit tests using in-memory database</a> &nbsp;<span class="pubdate">September 27th 2010</span></li><li><a href="/posts/test_dependencies_in_maven/">Test dependencies in Maven</a> &nbsp;<span class="pubdate">August 26th 2010</span></li><li><a href="/posts/using_java_visualvm_with_jboss_as_5_1/">Using Java VisualVM with JBoss AS 5.1</a> &nbsp;<span class="pubdate">June 29th 2010</span></li></nav></section></section></div><div class="col-md-2"></div></div></div><footer><div class="container"><div class="row"><div class="col-md-2 visible-md visible-lg"></div><div class="col-md-8"><ui class="list-inline"><li><a href="/pages/about">About</a></li></ui><div class="pull-right">© Brisk Bee 2018</div></div><div class="col-md-2 visible-md visible-lg"></div></div></div></footer><!-- Scripts--><script defer="defer"  src="/vendor/prettify.js"></script><script defer="defer"  src="/vendor/jquery/jquery.min.js"></script><script defer="defer"  src="/vendor/bootstrap/js/bootstrap.min.js"></script><script defer="defer"  src="/vendor/log.js"></script><script defer="defer"  src="/vendor/modernizr.js"></script><script defer="defer"  src="/scripts/script.js"></script><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-18789185-3']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></body></html>